<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>

<script>

    console.log("Firebase Config:", {
        apiKey: "{{ firebase_config.API_KEY }}",
        authDomain: "{{ firebase_config.AUTH_DOMAIN }}",
        projectId: "{{ firebase_config.PROJECT_ID }}",
        storageBucket: "{{ firebase_config.STORAGE_BUCKET }}",
        messagingSenderId: "{{ firebase_config.MESSAGING_SENDER_ID }}",
        appId: "{{ firebase_config.APP_ID }}"
    });
    // Your web app's Firebase configuration
    var firebaseConfig;
    firebaseConfig = {
        apiKey: "{{ firebase_config.API_KEY }}",
        authDomain: "{{ firebase_config.AUTH_DOMAIN }}",
        projectId: "{{ firebase_config.PROJECT_ID }}",
        storageBucket: "{{ firebase_config.STORAGE_BUCKET }}",
        messagingSenderId: "{{ firebase_config.MESSAGING_SENDER_ID }}",
        appId: "{{ firebase_config.APP_ID }}"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>


<script>
    const messaging = firebase.messaging();

    messaging.onMessage((payload) => {
        window.location.reload();
    });

    Notification.requestPermission().then((permission) => {
        if (permission === 'granted') {
            console.log('Notification permission granted.');
            // Proceed with getting the token
            return messaging.getToken({vapidKey: "{{ firebase_config.VAPID_KEY }}"});
        } else {
            console.log('Unable to get permission to notify.');
            throw new Error('Permission not granted');
        }
    }).then((currentToken) => {
        if (currentToken) {
            console.log('Token:', currentToken);
            fetch('{% url "couriers:courier_delivery_tasks_fcm" %}?fcm_token=' + currentToken);
        } else {
            console.log('No registration token available. Request permission to generate one.');
        }
    }).catch((err) => {
        console.log('An error occurred while retrieving token. ', err);
    });
</script>


